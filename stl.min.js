/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
class STLExporter{parse(t,e={}){e=Object.assign({binary:!1},e);let o=e.binary,n=[],r=0;t.traverse(function(t){if(t.isMesh){let e=t.geometry,o=e.index,l=e.getAttribute("position");r+=null!==o?o.count/3:l.count/3,n.push({object3d:t,geometry:e})}});let l,i=80;if(!0===o){let s=2*r+48*r+80+4,a=new ArrayBuffer(s);(l=new DataView(a)).setUint32(i,r,!0),i+=4}else l="",l+="solid exported\n";let f=new Vector3,p=new Vector3,u=new Vector3,$=new Vector3,c=new Vector3,x=new Vector3;for(let y=0,d=n.length;y<d;y++){let m=n[y].object3d,b=n[y].geometry,g=b.index,w=b.getAttribute("position");if(null!==g)for(let z=0;z<g.count;z+=3){let B=g.getX(z+0),F=g.getX(z+1),A=g.getX(z+2);v(B,F,A,w,m)}else for(let M=0;M<w.count;M+=3){let _=M+0,h=M+1,T=M+2;v(_,h,T,w,m)}}return!1===o&&(l+="endsolid exported\n"),l;function v(t,e,n,r,s){var a,y,d;f.fromBufferAttribute(r,t),p.fromBufferAttribute(r,e),u.fromBufferAttribute(r,n),!0===s.isSkinnedMesh&&(s.applyBoneTransform(t,f),s.applyBoneTransform(e,p),s.applyBoneTransform(n,u)),f.applyMatrix4(s.matrixWorld),p.applyMatrix4(s.matrixWorld),u.applyMatrix4(s.matrixWorld),a=f,y=p,d=u,$.subVectors(d,y),c.subVectors(a,y),$.cross(c).normalize(),x.copy($).normalize(),!0===o?(l.setFloat32(i,x.x,!0),i+=4,l.setFloat32(i,x.y,!0),i+=4,l.setFloat32(i,x.z,!0),i+=4):(l+="	facet normal "+x.x+" "+x.y+" "+x.z+"\n",l+="		outer loop\n"),W(f),W(p),W(u),!0===o?(l.setUint16(i,0,!0),i+=2):(l+="		endloop\n",l+="	endfacet\n")}function W(t){!0===o?(l.setFloat32(i,t.x,!0),i+=4,l.setFloat32(i,t.y,!0),i+=4,l.setFloat32(i,t.z,!0),i+=4):l+="			vertex "+t.x+" "+t.y+" "+t.z+"\n"}}}